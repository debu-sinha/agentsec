rules:
  - id: mcp-python-subprocess-shell-true
    languages: [python]
    severity: ERROR
    message: "subprocess call with shell=True can enable command injection."
    patterns:
      - pattern-either:
          - pattern: subprocess.run(..., shell=True, ...)
          - pattern: subprocess.Popen(..., shell=True, ...)
          - pattern: subprocess.call(..., shell=True, ...)
          - pattern: subprocess.check_output(..., shell=True, ...)
    metadata:
      category: security
      confidence: medium

  - id: mcp-python-os-system
    languages: [python]
    severity: WARNING
    message: "os.system executes shell commands; validate and sanitize all untrusted input."
    pattern: os.system(...)
    metadata:
      category: security
      confidence: medium

  - id: mcp-js-child-process-exec
    languages: [javascript, typescript]
    severity: ERROR
    message: "child_process exec-like APIs may execute unsanitized shell commands."
    patterns:
      - pattern-either:
          - pattern: child_process.exec(...)
          - pattern: child_process.execSync(...)
          - pattern: exec(...)
          - pattern: execSync(...)
    metadata:
      category: security
      confidence: medium

  - id: mcp-python-dynamic-exec
    languages: [python]
    severity: ERROR
    message: "Dynamic code execution via eval/exec is high risk."
    patterns:
      - pattern-either:
          - pattern: eval(...)
          - pattern: exec(...)
    metadata:
      category: security
      confidence: medium

  - id: mcp-js-dynamic-exec
    languages: [javascript, typescript]
    severity: ERROR
    message: "Dynamic code execution via eval/Function is high risk."
    patterns:
      - pattern-either:
          - pattern: eval(...)
          - pattern: new Function(...)
    metadata:
      category: security
      confidence: medium

  - id: mcp-python-pickle-loads
    languages: [python]
    severity: ERROR
    message: "pickle.loads on untrusted data can lead to code execution."
    pattern: pickle.loads(...)
    metadata:
      category: security
      confidence: high

  - id: mcp-python-yaml-unsafe-load
    languages: [python]
    severity: ERROR
    message: "yaml.load without SafeLoader can be unsafe."
    patterns:
      - pattern: yaml.load(...)
      - pattern-not: yaml.load(..., Loader=yaml.SafeLoader, ...)
    metadata:
      category: security
      confidence: medium

  - id: mcp-python-requests-verify-false
    languages: [python]
    severity: WARNING
    message: "TLS verification disabled (verify=False)."
    pattern: requests.$METHOD(..., verify=False, ...)
    metadata:
      category: security
      confidence: high

  - id: mcp-js-insecure-tls-rejectunauthorized
    languages: [javascript, typescript]
    severity: WARNING
    message: "TLS verification disabled via rejectUnauthorized: false."
    pattern: "{ ..., rejectUnauthorized: false, ... }"
    metadata:
      category: security
      confidence: medium
