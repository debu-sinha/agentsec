FROM node:22-slim

# Install system dependencies (git needed for openclaw npm install)
RUN apt-get update && apt-get install -y git python3 python3-pip python3-venv && \
    rm -rf /var/lib/apt/lists/*

# Install OpenClaw
RUN npm install -g openclaw

# Install agentsec from local source
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
COPY . /opt/agentsec-src
RUN pip install /opt/agentsec-src

# Create a test user
RUN useradd -m testuser
USER testuser
WORKDIR /home/testuser

CMD ["bash"]
